var sync=function(){"use strict";var n=function(){var n,e,t=new Promise(function(t,r){n=t,e=r});return arguments.length&&n(arguments[0]),t.resolve=n,t.reject=e,t};var e=function n(e,t){return t instanceof Array&&(t=t.reduce(n,[])),(e=e||[]).concat(t)},t=function(n,e,t,r){return n.host&&n.host.nodeName&&(n=n.host),e.name&&(t=e,e=e.name),!function(n,e){return e in n}(n,e)&&Object.defineProperty(n,e,{value:t,writable:r}),n[e]},r=function(){},i=function i(u,o){return o=o||{},t(u=u||{},"emit",function(n,t,r){for(var i=u.on[n.split(".")[0]]||[],o=[],f=0;f<i.length;f++)i[f].ns&&r&&!r(i[f].ns)||o.push(c(i[f].isOnce?i.splice(f--,1)[0]:i[f],t));for(var f=0;f<u.on["*"].length;f++)o.push(c(u.on["*"][f],[n,t]));return o.reduce(e,[])},1),t(u,"once",function(n,e){return u.on(n,e,!0)},1),t(u,"off",function(n,e){f(u.on[n]||[],e),e&&e.ns&&delete u.on[n]["$"+e.ns];return u},1),t(u,"on",function(n,e,t){var i=n.split(".")[0],c=n.split(".")[1],s=u.on[i]=u.on[i]||[],l="function"==typeof e?e:0;return!l&&c?(l=u.on[i]["$"+c])?l:p(a(u,e)):l||c?l&&c?p((f(s,u.on[i]["$"+c]||-1),l)):!(!l||c)&&p(l):p(a(u,e));function p(n){return n.isOnce=t,n.type=i,c&&(u.on[i]["$"+(n.ns=c)]=n),s.push(n),(o.on||r)(n),n.next?n:u}},1),u.on["*"]=u.on["*"]||[],u;function c(n,e){return n.next?n.next(e):e instanceof Array?n.apply(u,e):n.call(u,e)}function f(n,e){for(var t=n.length;~--t;)e!=n[t]&&e!=n[t].fn&&e||(o.off||r)(n.splice(t,1)[0])}function a(e,t){var r=i((t=t||{}).base||n());return r.i=0,r.li=[],r.fn=t.fn,r.parent=e,r.source=t.fn?r.parent.source:r,r.on("stop",function(n){return r.type?r.parent.off(r.type,r):r.parent.off(r),r.reason=n}),r.each=function(n){var e=n.next?n:a(r,{fn:n});return r.li.push(e),e},r.pipe=function(n){return n(r)},r.map=function(n){return r.each(function(e,t,r){return r.next(n(e,t,r))})},r.filter=function(n){return r.each(function(e,t,r){return n(e,t,r)&&r.next(e)})},r.reduce=function(n,e){return r.each(function(t,r,i){return i.next(e=n(e,t,r,i))})},r.unpromise=function(){var n=a(r,{base:{},fn:function(e){return n.next(e)}});return r.li.push(n),n},r.next=function(n){return r.resolve&&r.resolve(n),r.li.length?r.li.map(function(e){return e.fn(n,e.i++,e)}):n},r.until=function(n){return(n.each||n.then).call(n,function(n){return r.source.emit("stop",n)}),r},r.off=function(n){return f(r.li,n),r},r.start=function(){return r.source.emit("start"),r},r[Symbol.asyncIterator]=function(){return{next:function(){return r.wait=new Promise(function(n){r.wait=!0,r.map(function(e,t,i){delete r.wait,r.off(i),n({value:e,done:!1})}),r.emit("pull",r)})}}},r}},u=Math.min,o=Math.pow,c=function(n,e){return function(){var t=window.WebSocket,r=window.setTimeout,i=new t(e);i.onopen=function(){return n.emit("connected",i)},i.onmessage=function(e){return n.emit("recv",e.data)},i.onclose=function(){n.ready=n.once("connected"),n.emit("disconnected"),r(n.connect,f(++n.attempt))}}},f=function(n,e,t){return void 0===e&&(e=100),void 0===t&&(t=1e4),u(t,e*o(2,n))},a=s;function s(n){return function(e){return e==n}}s.fn=function(n){return"function"==typeof n},s.str=function(n){return"string"==typeof n},s.num=function(n){return"number"==typeof n},s.obj=function(n){return"object"==typeof n},s.lit=function(n){return n.constructor==Object},s.bol=function(n){return"boolean"==typeof n},s.truthy=function(n){return 1==!!n},s.falsy=function(n){return 0==!!n},s.arr=function(n){return n instanceof Array},s.null=function(n){return null===n},s.def=function(n){return void 0!==n},s.in=function(n){return function(e){return!!n&&(n.indexOf?~n.indexOf(e):e in n)}},s.promise=function(n){return n instanceof Promise},s.stream=function(n){return!(!n||!n.next)};var l=function(n){return Object.keys(a.obj(n)||a.fn(n)?n:{})},p=function(n){return n.__data__},d=function(n){return function(){return n}},v=function(n){return 0===n?"0":n?a.fn(n)?""+n:a.obj(n)?JSON.stringify(n):String(n):""},m=function n(e,t){var r=arguments.length>1,i=a.fn(e)?[]:v(e).split(".").filter(Boolean),u=i.shift();return function(o,c){var f={};return o?a.num(e)||e?a.arr(e)?(e.map(function(e){var r=n(e)(o);null!=(r=a.fn(t)?t(r):null==r?t:r)&&n(e,a.fn(r)?d(r):r)(f)}),f):o[e]||!i.length?r?(o[e]=a.fn(t)?t(o[e],c):t,o):a.fn(e)?e(o):o[e]:r?(n(i.join("."),t)(o[u]?o[u]:o[u]={}),o):n(i.join("."))(o[u]):r?function(n,e){return l(n).map(function(e){delete n[e]}),l(e).map(function(t){n[t]=e[t]}),n}(o,t):o:void 0}},h=b;function b(n){return function(e){return m(e)(n)}}b.parent=function(n){return p(this.parentNode)[n]};var y,g=(function(n){!function(){var e="object array date function".split(" "),t="_CRYO_REF_",r="_CRYO_INFINITY_",i="_CRYO_FUNCTION_",u="_CRYO_UNDEFINED_",o="_CRYO_DATE_",c="_CRYO_OBJECT_",f="_CRYO_ARRAY_";function a(n){return"object"==typeof n?null===n?"null":n&&1===n.nodeType?"dom":n instanceof Array?"array":n instanceof Date?"date":"object":typeof n}function s(n){var e=arguments,t=arguments.length;if(t<2||null==n)return n;for(var r=1;r<t;r++)for(var i=e[r],u=Object.keys(i),o=u.length,c=0;c<o;c++){var f=u[c];void 0===n[f]&&(n[f]=i[f])}return n}function l(n){var e=a(n);return"undefined"===e?u:"function"===e?i+n.toString():"date"===e?o+n.getTime():n===1/0?r:"dom"!==e?n:void 0}function p(n,e){return"string"===a(n)&&n.slice(0,e.length)===e}var d={stringify:function(n,r){var i=[],u=function n(r,i,u,o){u.prepare&&u.prepare(r),o=o||[];var s=a(r);if(-1!==e.indexOf(s)){var p=o.indexOf(r);if(-1===p){var d={};for(var v in p=i.push({contents:d,value:function(n){var e=a(n);return"function"===e||"date"===e?l(n):"object"===e?c:"array"===e?f:n}(r)})-1,o[p]=r,r)u.isSerializable(r,v)&&(d[v]=n(r[v],i,u,o))}return t+p}return l(r)}(n,i,r=s((r="function"==typeof r?{prepare:r}:r)||{},{prepare:null,isSerializable:function(n,e){return n.hasOwnProperty(e)}}));return JSON.stringify({root:u,references:i})},parse:function(n,e){var l=JSON.parse(n);return e=s((e="function"==typeof e?{finalize:e}:e)||{},{finalize:null}),function n(e,s,l,d){if(d=d||[],p(e,t)){var v=parseInt(e.slice(t.length),10);if(!d.hasOwnProperty(v)){var m=s[v],h=function(n){if("string"===a(n)){if(n===u)return;if(p(n,i))return new Function("return "+n.slice(i.length))();if(p(n,o)){var e=parseInt(n.slice(o.length),10);return new Date(e)}if(p(n,c))return{};if(p(n,f))return[];if(n===r)return 1/0}return n}(m.value),b=m.contents;for(var y in d[v]=h,b)h[y]=n(b[y],s,l,d)}return l.finalize&&l.finalize(d[v]),d[v]}return l.finalize&&l.finalize(e),function(n){if("string"===a(n)){if(n===u)return;if(p(n,i)){var e=n.slice(i.length),t=e.indexOf("(")+1,c=e.indexOf(")",t),f=e.slice(t,c),s=e.indexOf("{")+1,l=e.lastIndexOf("}")-1,d=e.slice(s,l);return new Function(f,d)}if(p(n,o)){var v=parseInt(n.slice(o.length),10);return new Date(v)}if(n===r)return 1/0}return n}(e)}(l.root,l.references,e)}};n.exports?n.exports=d:this.Cryo=d}()}(y={exports:{}},y.exports),y.exports),x=function(n){void 0===n&&(n={});var e=n.socket;void 0===e&&(e=function(n){void 0===n&&(n=location.href.replace("http","ws"));var e=i({attempt:0});return e.ready=e.once("connected"),e.connect=c(e,n),e.connect(),e.send=function(n){return e.ready.then(function(e){return e.send(n)})},e}()),e.id=0;var t=i({socket:e,send:w(e),get subscriptions(){return(n=e.on,n?l(n).map(h(n)):[]).map(function(n){return n&&n[0]}).filter(function(n){return n&&n.type&&"$"==n.type[0]});var n}});return e.once("disconnected").map(function(){return e.on("connected").map(O(t))}),e.on("recv").map(function(n){return _(n)}).each(function(n){var r=n.id,i=n.data,u=n.server,o=e.on["$"+r]&&e.on["$"+r][0];u?t.emit("recv",{id:r,data:i,server:u}):i.exec?i.exec(o,i.value):e.emit("$"+r,i)}),t},O=function(n){return function(){return n.subscriptions.map(function(e){var t=e.subscription;return n.socket.send(t)})}},_=g.parse,w=function(n,e){return function(t,r){if(t instanceof window.Blob)return j(n,t,r);var i=v(++n.id),u=n.on("$"+i),o=function(t,r){return void 0===r&&(r=0),n.send(u.source.subscription=v({id:i,data:t,type:e})).then(function(){return u.emit("sent",{id:i,count:r})})};return t.next?t.map(o).source.emit("start"):o(t),u.source.once("stop").filter(function(n){return"CLOSED"!=n}).map(function(){return w(n,"UNSUBSCRIBE")(i).filter(function(n,e,t){return t.source.emit("stop","CLOSED")})}),u}},j=function(n,e,t,r,u){void 0===r&&(r=0),void 0===u&&(u=1024);var o=i().on("recv"),c=function(t){return function(){return r>=e.size?o.emit("sent",{id:t}):(n.send(e.slice(r,r+=u)),window.setTimeout(c(t)))}};return w(n,"BINARY")({size:e.size,meta:t}).on("sent",function(n){var e=n.id;return c(e)()}).on("progress",function(n){return o.emit("progress",{received:n,total:e.size})}).map(o.next).source.until(o.once("stop")),o},S={arr:function(n){return Array.prototype.slice.call(n,0)},obj:function(n){var e="id";return 1==arguments.length?(e=n,t):t.apply(this,arguments);function t(n,t,r){return 0===r&&(n={}),n[a.fn(e)?e(t,r):t[e]]=t,n}}};var z={add:function(n,e,t){a.arr(n)?n.splice(e,0,t):n[e]=t},update:function(n,e,t){if(a.num(e)||e)n[e]=t;else{if(!a.obj(t))return!0;for(var r in n)delete n[r];for(var r in t)n[r]=t[r]}},remove:function(n,e){a.arr(n)?n.splice(e,1):delete n[e]}},N=JSON.stringify,C=JSON.parse,R=function(n,e){return function(r,u,o){if(!a.obj(r)&&!a.fn(r))return r;if(!a.obj(n)){var c=u||r.log||[],f=r;if(a.def(o)||(o=c.max||0),o||(c=[]),o<0&&(c=c.concat(null)),o>0){var s=N(r);f=C(s),c=c.concat({type:"update",value:C(s),time:c.length})}return t(c,"max",o),f.log?f.log=c:t(i(f,null),"log",c,1),f}return!!a.def(n.key)&&(!!function n(e,t,r,i){var u=r.shift();if(!z[t])return!1;if(r.length){if(!(u in e)){if("remove"==t)return!0;e[u]={}}return n(e[u],t,r,i)}return!z[t](e,u,i)}(r,n.type,(n.key=""+n.key).split(".").filter(Boolean),n.value)&&(r.log&&r.log.max&&r.log.push((n.time=r.log.length,r.log.max>0?n:null)),!e&&r.emit&&r.emit("change",n),r))}};var k=function(n){var e=n.server;return function(n,t,r){return n instanceof Blob?e.send(n,t):a.obj(n)?e.send(n):e.send({name:n,type:t,value:r})}},I=function(n){return function(e,t){return n.subscribe(e,t).filter(function(n,e,t){return t.source.emit("stop")}).start()}},A=function(n,e,t){return function(r){var i;return r.name&&e!=r.name&&n.link(e,r.name),a.def(t)&&(r.key=t+"."+v(r.key)),r.key||"update"!=r.type?R(r)(n.resources[e]?n(e):n(e,{})):n(T((i={name:e},function(n){var e;return l(n).filter((e=a.in(i),function(){return!e.apply(this,arguments)})).map(function(n,e){return function(t){return e[t]=n[t],t}}(n,i)),i})(r))),n.change=Y({name:e},r),m(t)(n(e))}},B=function(n){return function(e,t){if(a.arr(e))return D(e.map(function(e){return n.subscribe(e,t)})).map(function(n){return e.reduce(function(e,t,r){return e[t]=n[r],e},{})});if(n.subscriptions[e]=n.subscriptions[e]||{},a.arr(t))return D(t.map(function(t){return n.subscribe(e,t)})).map(function(){return m(t)(n(e))});var r=i().on("subscription");r.on("stop").each(function(){u.subs.splice(u.subs.indexOf(r),1),function(n,e){1===arguments.length?setTimeout(n):setTimeout(e,n)}(1e3,function(){u.subs.length||(u.source.emit("stop"),n.subscriptions[e][t]=void 0,r.emit("end"))})}),n.subscriptions[e][t]&&r.on("start").map(function(){return m(t)(n(e))}).filter(a.def).map(function(n){return r.next(n)});var u=n.subscriptions[e][t]=n.subscriptions[e][t]||n.send(e,"SUBSCRIBE",t).map(A(n,e,t)).each(function(e){u.subs.map(function(n){return n.next(e)}),delete n.change});return u.subs=u.subs||[],u.subs.push(r),r}},E=function(n){return function(t,r){var i=++n.upload.id,u={},o=0,c=function(){if(!f.length)return!0;var e=f.shift(),t=e.field,r=e.filename,u=e.i,s=e.blob;return n.send(s,{filename:r,field:t,i:u,index:i}).on("progress",function(n){var e=n.received;return a.emit("progress",{total:o,received:o-(s.size-e)-f.reduce(function(n,e){return n+e.blob.size},0)})}).then(c)},f=l(r).map(function(n){return u[n]=r[n],n}).filter(function(n){return r[n]instanceof FileList}).map(function(n){return u[n]=[],S.arr(r[n]).map(function(n){return o+=n.size,n}).map(function(e,t){return{field:n,filename:e.name,i:t,blob:e,sent:0}})}).reduce(e,[]),a=n.send({files:f.length,type:"PREUPLOAD",fields:u,index:i,size:o,name:t}).once("sent",c);return a}},T=function(n){var e=n.name,t=n.value;return{name:e,headers:n.headers,body:t}},Y=Object.assign,D=function(n){var e=i().on("merged");return e.streams=n,n.map(function(t){return t.each(function(r){t.latest=r;var i=n.map(function(n){return n.latest});i.every(a.def)&&e.next(i)})}),e.once("start").map(function(){return n.map(function(n){return n.source.emit("start")})}),e.once("stop").map(function(){return n.map(function(n){return n.source.emit("stop")})}),e};return function(n,e,t){void 0===e&&(e={}),void 0===t&&(t={});var r=t.xrs;return void 0===r&&(r=x),n.server=r(),n.send=k(n),n.subscribe=B(n),n.subscriptions={},n.get=I(n),n.upload=E(n),n.upload.id=0,n.server.on("recv").map(function(e,t,r){var i=e.data,u=e.server;return A(n,u.name)(i,t,r)}),n}}();
