var core=function(){"use strict";var n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var r=function(){var n,r,e=new Promise(function(e,t){n=e,r=t});return arguments.length&&n(arguments[0]),e.resolve=n,e.reject=r,e};var e=function n(r,e){return e instanceof Array&&(e=e.reduce(n,[])),(r=r||[]).concat(e)},t=function(n,r,e,t){return n.host&&n.host.nodeName&&(n=n.host),r.name&&(e=r,r=r.name),!function(n,r){return r in n}(n,r)&&Object.defineProperty(n,r,{value:e,writable:t}),n[r]},o=function(){},u="undefined"!=typeof window,i=c;function c(n){return function(r){return r==n}}c.fn=function(n){return"function"==typeof n},c.str=function(n){return"string"==typeof n},c.num=function(n){return"number"==typeof n},c.obj=function(n){return"object"==typeof n},c.lit=function(n){return n.constructor==Object},c.bol=function(n){return"boolean"==typeof n},c.truthy=function(n){return 1==!!n},c.falsy=function(n){return 0==!!n},c.arr=function(n){return n instanceof Array},c.null=function(n){return null===n},c.def=function(n){return void 0!==n},c.in=function(n){return function(r){return!!n&&(n.indexOf?~n.indexOf(r):r in n)}},c.promise=function(n){return n instanceof Promise},c.stream=function(n){return!(!n||!n.next)};["red","green","bold","grey","strip"].forEach(function(n){!i.str(String.prototype[n])&&Object.defineProperty(String.prototype,n,{get:function(){return String(this)}})});var f=function(n){return function(){return n}},s=function(n){return Object.keys(i.obj(n)||i.fn(n)?n:{})},a=function n(r,e){var t,o=arguments.length>1,u=i.fn(r)?[]:(t=r,0===t?"0":t?i.fn(t)?""+t:i.obj(t)?JSON.stringify(t):String(t):"").split(".").filter(Boolean),c=u.shift();return function(t,a){var l={};return t?i.num(r)||r?i.arr(r)?(r.map(function(r){var o=n(r)(t);null!=(o=i.fn(e)?e(o):null==o?e:o)&&n(r,i.fn(o)?f(o):o)(l)}),l):t[r]||!u.length?o?(t[r]=i.fn(e)?e(t[r],a):e,t):i.fn(r)?r(t):t[r]:o?(n(u.join("."),e)(t[c]?t[c]:t[c]={}),t):n(u.join("."))(t[c]):o?function(n,r){return s(n).map(function(r){delete n[r]}),s(r).map(function(e){n[e]=r[e]}),n}(t,e):t:void 0}},l=function(n,r){var e=1==arguments.length;return function(t){return t&&t.headers?e?a(n)(t.headers):a(n)(t.headers)==r:null}},p=function(n){return n.__data__},d=y;function y(n){return function(r){return a(r)(n)}}y.parent=function(n){return p(this.parentNode)[n]};var h=function(n){return n?s(n).map(d(n)):[]},v={arr:function(n){return Array.prototype.slice.call(n,0)},obj:function(n){var r="id";return 1==arguments.length?(r=n,e):e.apply(this,arguments);function e(n,e,t){return 0===t&&(n={}),n[i.fn(r)?r(e,t):e[r]]=e,n}}};var g=function(){return function n(r){return function(e,t){if(!r.length)return 0;var o=r[0],u=a(o)(e)||"",i=a(o)(t)||"";return u<i?1:u>i?-1:n(r.slice(1))(e,t)}}(v.arr(arguments))};var m,b=function(n){return function(r){return r&&r.indexOf&&~r.indexOf(n)}},x={header:"text/plain",check:function(n){return!b(".html")(n.name)&&!b(".css")(n.name)&&i.str(n.body)}},j=u?window:n;return function(n){n.exports=function(n){void 0===n&&(n={});var u=n.aliases;return void 0===u&&(u={}),w("creating"),f.resources={},f.link=m(f),f.register=f,f.types=d(),y(function n(u,i){return i=i||{},t(u=u||{},"emit",function(n,r,t){for(var o=u.on[n.split(".")[0]]||[],i=[],f=0;f<o.length;f++)o[f].ns&&t&&!t(o[f].ns)||i.push(c(o[f].isOnce?o.splice(f--,1)[0]:o[f],r));for(var f=0;f<u.on["*"].length;f++)i.push(c(u.on["*"][f],[n,r]));return i.reduce(e,[])},1),t(u,"once",function(n,r){return u.on(n,r,!0)},1),t(u,"off",function(n,r){return f(u.on[n]||[],r),r&&r.ns&&delete u.on[n]["$"+r.ns],u},1),t(u,"on",function(n,r,e){var t=n.split(".")[0],c=n.split(".")[1],a=u.on[t]=u.on[t]||[],l="function"==typeof r?r:0;return!l&&c?(l=u.on[t]["$"+c])?l:p(s(u,r)):l||c?l&&c?p((f(a,u.on[t]["$"+c]||-1),l)):!(!l||c)&&p(l):p(s(u,r));function p(n){return n.isOnce=e,n.type=t,c&&(u.on[t]["$"+(n.ns=c)]=n),a.push(n),(i.on||o)(n),n.next?n:u}},1),u.on["*"]=u.on["*"]||[],u;function c(n,r){return n.next?n.next(r):r instanceof Array?n.apply(u,r):n.call(u,r)}function f(n,r){for(var e=n.length;~--e;)r!=n[e]&&r!=n[e].fn&&r||(i.off||o)(n.splice(e,1)[0])}function s(e,t){var o=n((t=t||{}).base||r());return o.i=0,o.li=[],o.fn=t.fn,o.parent=e,o.source=t.fn?o.parent.source:o,o.on("stop",function(n){return o.type?o.parent.off(o.type,o):o.parent.off(o),o.reason=n}),o.each=function(n){var r=n.next?n:s(o,{fn:n});return o.li.push(r),r},o.pipe=function(n){return n(o)},o.map=function(n){return o.each(function(r,e,t){return t.next(n(r,e,t))})},o.filter=function(n){return o.each(function(r,e,t){return n(r,e,t)&&t.next(r)})},o.reduce=function(n,r){return o.each(function(e,t,o){return o.next(r=n(r,e,t,o))})},o.unpromise=function(){var n=s(o,{base:{},fn:function(r){return n.next(r)}});return o.li.push(n),n},o.next=function(n){return o.resolve&&o.resolve(n),o.li.length?o.li.map(function(r){return r.fn(n,r.i++,r)}):n},o.until=function(n){return(n.each||n.then).call(n,function(n){return o.source.emit("stop",n)}),o},o.off=function(n){return f(o.li,n),o},o.start=function(){return o.source.emit("start"),o},o[Symbol.asyncIterator]=function(){return{next:function(){return o.wait=new Promise(function(n){o.wait=!0,o.map(function(r,e,t){delete o.wait,o.off(t),n({value:r,done:!1})}),o.emit("pull",o)})}}},o}}(f),u);function f(n,r,e){return n?i.arr(n)?n.map(f):i.promise(n)?n.then(f).catch(b):i.obj(n)&&!n.name?f(h(n)):i.fn(n)&&n.resources?f(h(n.resources)):i.str(n)&&!r&&f.resources[n]?f.resources[n].body:!i.str(n)||r||f.resources[n]?i.str(n)&&r?c(f)({name:n,body:r,headers:e}):i.obj(n)?c(f)(n):(b("could not find or create resource",n),!1):void 0:f}};var u,c=function(n){return function(r){var e=r.name,t=r.body,o=r.headers;if(void 0===o&&(o={}),e=n.aliases.src[e]||e,i.promise(t))return t.then(function(r){return c(n)({name:e,body:r,headers:o})}).catch(b);w("registering",e);var u=f(n)({name:e,body:t,headers:o});return u?(n.resources[e]=u,n.emit("change",[e,{type:"update",value:u.body,time:O(u)}]),n.resources[e].body):(b("failed to register",e),!1)}},f=function(n){return function(r){return l("content-type")(r)||h(n.types).sort(g("priority")).some(p(r)),l("content-type")(r)?s(n)(r):(b("could not understand resource",r),!1)}},s=function(n){return function(r){var e=l("content-type")(r);return n.types[e]?(n.types[e].parse||function(n){return n})(r):(b("could not understand type",e),!1)}},p=function(n){return function(r){return r.check(n)&&(n.headers["content-type"]=r.header)}},d=function(){return[x].reduce(v.obj("header"),1)},y=function(n,r){for(var e in n.aliases={dst:{},src:{}},r)n.link(r[e],e);return n},m=function(n){return function(r,e){n.aliases.src[r]=e,n.aliases.dst[e]=r,Object.defineProperty(n.resources,r,{get:function(){return n.resources[e]},set:function(r){n.resources[e]=r}})}},b=(u="[ri/core]",function(n){if(!j.console||!console.error.apply)return n;i.arr(arguments[2])&&(arguments[2]=arguments[2].length);var r=v.arr(arguments),e="[err]["+(new Date).toISOString()+"]"+u;return r.unshift(e.red?e.red:e),console.error.apply(console,r),n}),w=function(n){return function(r){if(!j.console||!console.log.apply)return r;i.arr(arguments[2])&&(arguments[2]=arguments[2].length);var e=v.arr(arguments),t="[log]["+(new Date).toISOString()+"]"+n;return e.unshift(t.grey?t.grey:t),console.log.apply(console,e),r}}("[ri/core]"),O=function(n,r){return r=a("body.log.length")(n),i.num(r)?r-1:r}}(m={exports:{}},m.exports),m.exports}();
